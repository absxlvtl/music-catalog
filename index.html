<html>
<body>
  <input id="title" placeholder="Title" />
  <button id="btn">Create Order</button>
  <pre id="out"></pre>

  <script type="module">
    import { fetchWithResilience } from "./lib/http.js";
    import { getOrReuseKey } from "./lib/idempotency.js";

    const btn = document.getElementById("btn");
    const out = document.getElementById("out");

    btn.onclick = async () => {
      btn.disabled = true;

      const payload = { title: document.getElementById("title").value };
      const idemKey = await getOrReuseKey(payload);

      try {
        const res = await fetchWithResilience("http://localhost:8081/orders", {
          method: "POST",
          body: JSON.stringify(payload),
          idempotencyKey: idemKey,
          retry: { retries: 2, baseDelayMs: 300, timeoutMs: 3500, jitter: true }
        });

        const json = await res.json();
        out.textContent = JSON.stringify(json, null, 2);
      } finally {
        btn.disabled = false;
      }
    };
  </script>
</body>
</html>
